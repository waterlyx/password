<?php
//http://www.jb51.net/article/78645.htm
$url = './1.gif';
//从网址上获取验证码
$im = imagecreatefromgif($url);
// $img = LoadGif('c.gif');
//将验证码保存到本地
imagegif($im, '1.gif');
$rgbArray = array();
$res = $im;
//获取图片的大小
$size = getimagesize($url);
//返回图像的宽度
$wid = $size['0'];
//返回图像的高度
$hid = $size['1'];
//对图像的每一个像素进行分析
for ($i = 0; $i < $hid; ++ $i) {
    for ($j = 0; $j < $wid; ++ $j) {
        //取得某像素的颜色索引值
        $rgb = imagecolorat($res, $j, $i);
        //取得某索引的颜色
        $rgbArray[$i][$j] = imagecolorsforindex($res, $rgb);
    }
}

//全部的图案
for ($i = 5; $i < $hid-5; $i ++) {
    for ($j = 6; $j < $wid-8; $j ++) {
        if ($rgbArray[$i][$j]['red'] >= 150 && $rgbArray[$i][$j]['green'] >= 150 && $rgbArray[$i][$j]['blue'] >= 150) {
            // echo '□';//□
        } else {
            // echo '■';//■
        }
    }
    // echo "<br>";
}

echo '<hr>';
//定义数字
$one = '';
$two = '';
$three = '';
$four = '';

//第一个图案
for ($i = 5; $i < $hid-5; $i ++) {
    for ($j = 6; $j < $wid-35; $j ++) {
        if ($rgbArray[$i][$j]['red'] >= 145) {
            $one .= '0';
            // echo '□';//□
        } else {
            $one .= '1';
            // echo '■';//■
        }
    }
    // echo "<br>";
}
echo $one;
//7 2
echo '<hr>';
//第二个数字
for ($i = 5; $i < $hid-5; $i ++) {
    for ($j = 15; $j < $wid-26; $j ++) {
        if ($rgbArray[$i][$j]['red'] >= 145) {
            $two .= '0';
            // echo '□';//□
        } else {
            $two .= '1';
            // echo '■';//■
        }
    }
    // echo "<br>";
}
echo $two;

echo '<hr>';
//第三个数字
for ($i = 5; $i < $hid-5; $i ++) {
    for ($j = 24; $j < $wid-17; $j ++) {
        if ($rgbArray[$i][$j]['red'] >= 145) {
            $three .= '0';
            // echo '□';//□
        } else {
            $three .= '1';
            // echo '■';//■
        }
    }
    // echo "<br>";
}
echo $three;

echo '<hr>';
//第四个数字
for ($i = 5; $i < $hid-5; $i ++) {
    for ($j = 33; $j < $wid-8; $j ++) {
        if ($rgbArray[$i][$j]['red'] >= 145) {
            $four .= '0';
            // echo '□';//□
        } else {
            $four .= '1';
            // echo '■';//■
        }
    }
    // echo "<br>";
}
echo $four;

//定义字符数据库匹配
$dic = array (
    '001111000111110100011111001111000110100011010001111000101110011111000101110110011110',//0
    '000010000011100011100011111011001100001110000011000001101001110000011000011100000110',//1
    '001111001111111100011111001100000110000101000111000011001111000011100011011111111011',//2
    '001110001111100100011000001000001100001110001001100000011100011110001101111100011101',//3
    '000011000001100001110001110000101110110010010011011000101111111101111100001100000010',//4
    '001111100111110110000011000001111100011111110001100000011101011011001101111110011111',//5
    '001111001111110100011010000001011101111111111001111000010100001010001101111100011111',//6
    '111111111111110000011000011000011000001100001110000110001011000001100000110000111000',//7
    '001101001111111110111010011001100110011110011111011000111100011110001101111110011110',//8
    '001110001111101100011110001111000111100011011111100001011000011110001101111100011100',//9
);

$dic2 = array (
    '001111001111101110011110000110000111100001100000111000111110011001001001111100001110',//0
    '000010010111000011100011010001001000000100000011000001000000100000010000001000000100',//1
    '001111001111111110011100000100010110000011000111000111000011001011000111111111111111',//2
    '001111001111100100011000001101011100001110000100100000111100011101000101111110011110',//3
    '000011100001100001010001111100111110110110010011111001101111111111111100001100001111',//4
    '001111101111110110000011000001111000011111110001100000011100001011001101111110011010',//5
    '001111001111110010011110000111011101111111110001111000111100011011001101111110111110',//6
    '110111111111110000011000011000001000001100001110100110000011010001100010100000010000',//7
    '001110001111110110001110001101100010111110011111001000111100001111001101111110011100',//8
    '001110001111111100011110001111010111100011011111100111110000011111001111111100011100',//9
);

$dic3 = array (
    '001110001111100110011110000111000001100101110000111001011100111010001101111101011100',//0
    '000011000001000011100011111001001000001101000010000000000000100000010000001000000100',//1
    '001111001111111110011110001100000110001011100011000101100111000011000011011111111111',//2
    '001110001111100100001000001000011100000110000000100000101000011110101101000100011100',//3
    '000011100001100101110001111100111100110110110011011001101111011111111100001100000110',//4
    '011111001111010110000011000001111100111111110001100000111101011111001101111110011110',//5
    '001111001111110100011110000111011101111111110001101100011100001011001101101100011100',//6
    '111111111111110001011000011000101000001100001110000110000011000001100000010000011000',//7
    '101111101111111110011011001111100110011110011111011000111100001010101111111110011110',//8
    '001110001011101100011110001111001111100011011111100111010000001110001101111100011100',//9
);

$dic4 = array (
    '',//0
    '',//1
    '',//2
    '',//3
    '',//4
    '',//5
    '',//6
    '',//7
    '',//8
    '',//9
);

$dic5 = array (
    '',//0
    '',//1
    '',//2
    '',//3
    '',//4
    '',//5
    '',//6
    '',//7
    '',//8
    '',//9
);

$dic6 = array (
    '',//0
    '',//1
    '',//2
    '',//3
    '',//4
    '',//5
    '',//6
    '',//7
    '',//8
    '',//9
);


echo '<hr>';

$zhen = 0;
$data = '';
for($i = 0; $i<10;$i++){
    similar_text($one,$dic[$i],$percent);
    similar_text($one,$dic2[$i],$percent2);
    similar_text($one,$dic3[$i],$percent3);
    if(($percent+$percent2+$percent3) > $zhen){
        $zhen = ($percent+$percent2+$percent3);
        $value = $i;
    }

    // echo $percent.'<br>#';
    // echo '##'.$percent2.'<br>';
}
$data .= $value;

$zhen =0;

for($i = 0; $i<10;$i++){
    similar_text($two,$dic[$i],$percent);
    similar_text($two,$dic2[$i],$percent2);
    similar_text($two,$dic3[$i],$percent3);
    if(($percent+$percent2+$percent3) > $zhen){
        $zhen = ($percent+$percent2+$percent3);
        $value = $i;
    }
    // echo $percent.'<br>';
}
$data .= $value;

$zhen =0;

for($i = 0; $i<10;$i++){
    similar_text($three,$dic[$i],$percent);
    similar_text($three,$dic2[$i],$percent2);
    similar_text($three,$dic3[$i],$percent3);
    if(($percent+$percent2+$percent3) > $zhen){
        $zhen = ($percent+$percent2+$percent3);
        $value = $i;
    }
    // echo $percent.'<br>';
}
$data .= $value;

$zhen =0;

for($i = 0; $i<10;$i++){
    similar_text($four,$dic[$i],$percent);
    similar_text($four,$dic2[$i],$percent2);
    similar_text($four,$dic3[$i],$percent3);
    if(($percent+$percent2+$percent3) > $zhen){
        $zhen = ($percent+$percent2+$percent3);
        $value = $i;
    }
    // echo $percent.'<br>';
}
$data .= $value;
echo '<pre>';
var_dump($data);
echo "<br>";
?>
<image src='./1.gif'></image>